<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal Effects of Regression Models • ggeffects</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Marginal Effects of Regression Models">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggeffects</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/effectsatvalues.html">Marginal Effects at Specific Values</a>
    </li>
    <li>
      <a href="../articles/marginaleffects.html">Marginal Effects of Regression Models</a>
    </li>
    <li>
      <a href="../articles/plotmethod.html">Plotting Marginal Effects</a>
    </li>
    <li>
      <a href="../articles/stata.html">Different Output between Stata and ggeffects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Marginal Effects of Regression Models</h1>
                        <h4 class="author">Daniel Lüdecke</h4>
            
            <h4 class="date">2018-11-16</h4>
      
      
      <div class="hidden name"><code>marginaleffects.Rmd</code></div>

    </div>

    
    
<div id="aim-of-the-ggeffects-package" class="section level1">
<h1 class="hasAnchor">
<a href="#aim-of-the-ggeffects-package" class="anchor"></a>Aim of the ggeffects-package</h1>
<p>The aim of this package is similar to the <a href="https://cran.r-project.org/package=broom">broom-package</a>: transforming “untidy” input into a tidy data frame, especially for further use with <a href="https://cran.r-project.org/package=ggplot2">ggplot</a>. However, <strong>ggeffects</strong> does not return model-summaries; rather, this package computes marginal effects at the mean or average marginal effects from statistical models and returns the result as tidy data frame.</p>
<p>Since the focus lies on plotting the data (the marginal effects), at least one model term needs to be specified for which the effects are computed. It is also possible to compute marginal effects for model terms, grouped by the levels of another model’s predictor. The package also allows plotting marginal effects for two- or three-way-interactions, or for specific values of a model term only. Examples are shown below.</p>
</div>
<div id="consistent-and-tidy-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#consistent-and-tidy-structure" class="anchor"></a>Consistent and tidy structure</h1>
<p>The returned data frames always have the same, consistent structure and column names, so it’s easy to create ggplot-plots without the need to re-write the arguments to be mapped in each ggplot-call. <code>x</code> and <code>predicted</code> are the values for the x- and y-axis. <code>conf.low</code> and <code>conf.high</code> could be used as <code>ymin</code> and <code>ymax</code> aesthetics for ribbons to add confidence bands to the plot. <code>group</code> can be used as grouping-aesthetics, or for faceting.</p>
</div>
<div id="marginal-effects-at-the-mean" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-at-the-mean" class="anchor"></a>Marginal effects at the mean</h1>
<p><code><a href="../reference/ggpredict.html">ggpredict()</a></code> computes predicted values for all possible levels and values from a model’s predictors. In the simplest case, a fitted model is passed as first argument, and the term in question as second argument. Use the raw name of the variable for the <code>terms</code>-argument only - you don’t need to write things like <code>poly(term, 3)</code> or <code>I(term^2)</code> for the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggeffects)
<span class="kw">data</span>(efc)
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(barthtot <span class="op">~</span><span class="st"> </span>c12hour <span class="op">+</span><span class="st"> </span>neg_c_<span class="dv">7</span> <span class="op">+</span><span class="st"> </span>c161sex <span class="op">+</span><span class="st"> </span>c172code, <span class="dt">data =</span> efc)

<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="st">"c12hour"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = average number of hours of care per week </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    75.444     1.116   73.257    77.630</span>
<span class="co">#&gt;   20    70.378     0.925   68.564    72.191</span>
<span class="co">#&gt;   45    64.045     0.843   62.393    65.697</span>
<span class="co">#&gt;   65    58.979     0.930   57.157    60.802</span>
<span class="co">#&gt;   85    53.913     1.122   51.713    56.113</span>
<span class="co">#&gt;  105    48.847     1.377   46.148    51.546</span>
<span class="co">#&gt;  125    43.781     1.665   40.517    47.045</span>
<span class="co">#&gt;  170    32.382     2.373   27.732    37.033</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; *  neg_c_7 = 11.84</span>
<span class="co">#&gt; *  c161sex =  1.76</span>
<span class="co">#&gt; * c172code =  1.97</span></code></pre></div>
<p>As you can see, <code><a href="../reference/ggpredict.html">ggpredict()</a></code> and <code><a href="../reference/ggpredict.html">ggeffect()</a></code> have a nice <code>print()</code>-method, which takes care of printing not too many rows (but always an equally spaced range of values, including minimum and maximum value of the term in question) and giving some extra information. This is especially useful when predicted values are shown depending on the levels of other terms (see below).</p>
<p>The output shows the predicted values for the response at each value from the term <em>c12hour</em>. The data is already in shape for ggplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())

mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="st">"c12hour"</span>)
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="marginal-effects-at-the-mean-for-different-groups" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-at-the-mean-for-different-groups" class="anchor"></a>Marginal effects at the mean for different groups</h1>
<p>The <code>terms</code>-argument accepts up to three model terms, where the second and third term indicate grouping levels. This allows predictions for the term in question at different levels for other model terms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = average number of hours of care per week </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # low level of education</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    74.746     1.776   71.266    78.227</span>
<span class="co">#&gt;   30    67.147     1.587   64.037    70.257</span>
<span class="co">#&gt;   55    60.815     1.550   57.777    63.853</span>
<span class="co">#&gt;   85    53.216     1.662   49.958    56.473</span>
<span class="co">#&gt;  115    45.617     1.914   41.865    49.368</span>
<span class="co">#&gt;  170    31.685     2.593   26.602    36.768</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # intermediate level of education</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    75.465     1.114   73.282    77.647</span>
<span class="co">#&gt;   30    67.866     0.868   66.165    69.566</span>
<span class="co">#&gt;   55    61.533     0.872   59.824    63.243</span>
<span class="co">#&gt;   85    53.934     1.126   51.727    56.141</span>
<span class="co">#&gt;  115    46.335     1.522   43.352    49.318</span>
<span class="co">#&gt;  170    32.404     2.377   27.745    37.062</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # high level of education</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    76.183     1.718   72.816    79.550</span>
<span class="co">#&gt;   30    68.584     1.616   65.417    71.751</span>
<span class="co">#&gt;   55    62.252     1.656   59.006    65.497</span>
<span class="co">#&gt;   85    54.653     1.843   51.040    58.265</span>
<span class="co">#&gt;  115    47.053     2.143   42.853    51.254</span>
<span class="co">#&gt;  170    33.122     2.863   27.511    38.733</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; * neg_c_7 = 11.84</span>
<span class="co">#&gt; * c161sex =  1.76</span></code></pre></div>
<p>Creating a ggplot is pretty straightforward: the colour-aesthetics is mapped with the <code>group</code>-column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Finally, a second grouping structure can be defined, which will create another column named <code>facet</code>, which - as the name implies - might be used to create a facted plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>, <span class="st">"c161sex"</span>))
mydf
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = average number of hours of care per week </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # low level of education</span>
<span class="co">#&gt; # [1] Male</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    73.954     2.347   69.354    78.554</span>
<span class="co">#&gt;   45    62.556     2.208   58.228    66.883</span>
<span class="co">#&gt;   85    52.424     2.310   47.896    56.951</span>
<span class="co">#&gt;  170    30.893     3.085   24.847    36.939</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # low level of education</span>
<span class="co">#&gt; # [2] Female</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    74.996     1.831   71.406    78.585</span>
<span class="co">#&gt;   45    63.597     1.603   60.456    66.738</span>
<span class="co">#&gt;   85    53.465     1.702   50.130    56.800</span>
<span class="co">#&gt;  170    31.934     2.606   26.827    37.042</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # intermediate level of education</span>
<span class="co">#&gt; # [1] Male</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    74.673     1.845   71.055    78.290</span>
<span class="co">#&gt;   45    63.274     1.730   59.883    66.665</span>
<span class="co">#&gt;   85    53.142     1.911   49.397    56.887</span>
<span class="co">#&gt;  170    31.611     2.872   25.982    37.241</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # intermediate level of education</span>
<span class="co">#&gt; # [2] Female</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    75.714     1.225   73.313    78.115</span>
<span class="co">#&gt;   45    64.315     0.968   62.418    66.213</span>
<span class="co">#&gt;   85    54.183     1.209   51.815    56.552</span>
<span class="co">#&gt;  170    32.653     2.403   27.943    37.362</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # high level of education</span>
<span class="co">#&gt; # [1] Male</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    75.391     2.220   71.040    79.741</span>
<span class="co">#&gt;   45    63.992     2.176   59.727    68.258</span>
<span class="co">#&gt;   85    53.860     2.364   49.226    58.494</span>
<span class="co">#&gt;  170    32.330     3.257   25.946    38.713</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # high level of education</span>
<span class="co">#&gt; # [2] Female</span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    76.432     1.809   72.887    79.977</span>
<span class="co">#&gt;   45    65.034     1.712   61.679    68.388</span>
<span class="co">#&gt;   85    54.902     1.910   51.158    58.646</span>
<span class="co">#&gt;  170    33.371     2.895   27.697    39.045</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; * neg_c_7 = 11.84</span>
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="marginal-effects-for-each-model-term" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-for-each-model-term" class="anchor"></a>Marginal effects for each model term</h1>
<p>If the <code>term</code> argument is either missing or <code>NULL</code>, marginal effects for each model term are calculated. The result is returned as a list, which can be plotted manually (or using the <code><a href="../reference/plot.html">plot()</a></code> function).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit)
mydf
<span class="co">#&gt; $c12hour</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = average number of hours of care per week </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;    0    75.444     1.116   73.257    77.630</span>
<span class="co">#&gt;   20    70.378     0.925   68.564    72.191</span>
<span class="co">#&gt;   45    64.045     0.843   62.393    65.697</span>
<span class="co">#&gt;   65    58.979     0.930   57.157    60.802</span>
<span class="co">#&gt;   85    53.913     1.122   51.713    56.113</span>
<span class="co">#&gt;  105    48.847     1.377   46.148    51.546</span>
<span class="co">#&gt;  125    43.781     1.665   40.517    47.045</span>
<span class="co">#&gt;  170    32.382     2.373   27.732    37.033</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; *  neg_c_7 = 11.84</span>
<span class="co">#&gt; *  c161sex =  1.76</span>
<span class="co">#&gt; * c172code =  1.97</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $neg_c_7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = Negative impact with 7 items </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;   6    78.166     1.561   75.107    81.225</span>
<span class="co">#&gt;   8    73.571     1.206   71.207    75.935</span>
<span class="co">#&gt;  12    64.383     0.842   62.732    66.033</span>
<span class="co">#&gt;  14    59.788     0.972   57.883    61.693</span>
<span class="co">#&gt;  16    55.194     1.259   52.725    57.662</span>
<span class="co">#&gt;  20    46.005     2.021   42.043    49.966</span>
<span class="co">#&gt;  22    41.410     2.438   36.632    46.188</span>
<span class="co">#&gt;  28    27.627     3.735   20.306    34.947</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; *  c12hour = 42.20</span>
<span class="co">#&gt; *  c161sex =  1.76</span>
<span class="co">#&gt; * c172code =  1.97</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c161sex</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = carer's gender </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;  1    63.962     1.728   60.575    67.350</span>
<span class="co">#&gt;  2    65.004     0.966   63.110    66.897</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; *  c12hour = 42.20</span>
<span class="co">#&gt; *  neg_c_7 = 11.84</span>
<span class="co">#&gt; * c172code =  1.97</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c172code</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX </span>
<span class="co">#&gt; # x = carer's level of education </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;  1    64.057     1.554   61.012    67.103</span>
<span class="co">#&gt;  2    64.776     0.842   63.125    66.427</span>
<span class="co">#&gt;  3    65.494     1.621   62.317    68.672</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; * c12hour = 42.20</span>
<span class="co">#&gt; * neg_c_7 = 11.84</span>
<span class="co">#&gt; * c161sex =  1.76</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "ggalleffects" "list"</span></code></pre></div>
</div>
<div id="average-marginal-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#average-marginal-effects" class="anchor"></a>Average marginal effects</h1>
<p><code><a href="../reference/ggpredict.html">ggaverage()</a></code> compute average marginal effects. While <code><a href="../reference/ggpredict.html">ggpredict()</a></code> creates a data-grid (using <code>expand.grid()</code>) for all possible combinations of values (even if some combinations are not present in the data), <code><a href="../reference/ggpredict.html">ggaverage()</a></code> computes predicted values based on the given data. This means that <em>different</em> predicted values for the outcome may occure at the <em>same</em> value or level for the term in question. The predicted values are then averaged for each value of the term in question and the linear trend is smoothed accross the averaged predicted values. This means that the line representing the marginal effects may cross or diverge, and are not necessarily in paralell to each other.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggaverage</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="two--and-three-way-interactions" class="section level1">
<h1 class="hasAnchor">
<a href="#two--and-three-way-interactions" class="anchor"></a>Two- and Three-Way-Interactions</h1>
<p>To plot the marginal effects of interaction terms, simply specify these terms in the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sjmisc)
<span class="kw">data</span>(efc)

<span class="co"># make categorical</span>
efc<span class="op">$</span>c161sex &lt;-<span class="st"> </span><span class="kw">to_factor</span>(efc<span class="op">$</span>c161sex)

<span class="co"># fit model with interaction</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(neg_c_<span class="dv">7</span> <span class="op">~</span><span class="st"> </span>c12hour <span class="op">+</span><span class="st"> </span>barthtot <span class="op">*</span><span class="st"> </span>c161sex, <span class="dt">data =</span> efc)

<span class="co"># select only levels 30, 50 and 70 from continuous variable Barthel-Index</span>
mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"barthtot [30,50,70]"</span>, <span class="st">"c161sex"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Since the <code>terms</code>-argument accepts up to three model terms, you can also compute marginal effects for a 3-way-interaction. To plot the marginal effects of three interaction terms, just like before, specify all three terms in the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit model with 3-way-interaction</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(neg_c_<span class="dv">7</span> <span class="op">~</span><span class="st"> </span>c12hour <span class="op">*</span><span class="st"> </span>barthtot <span class="op">*</span><span class="st"> </span>c161sex, <span class="dt">data =</span> efc)

<span class="co"># select only levels 30, 50 and 70 from continuous variable Barthel-Index</span>
mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"barthtot [30,50,70]"</span>, <span class="st">"c161sex"</span>))

<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div id="polynomial-terms-and-splines" class="section level1">
<h1 class="hasAnchor">
<a href="#polynomial-terms-and-splines" class="anchor"></a>Polynomial terms and splines</h1>
<p><code><a href="../reference/ggpredict.html">ggpredict()</a></code> also works for models with polynomial terms or splines. Following code reproduces the plot from <code><a href="http://www.rdocumentation.org/packages/splines/topics/bs">?splines::bs</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(splines)
<span class="kw">data</span>(women)

fm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(height, <span class="dt">df =</span> <span class="dv">5</span>), <span class="dt">data =</span> women)
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fm1, <span class="st">"height"</span>)

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="survival-models" class="section level1">
<h1 class="hasAnchor">
<a href="#survival-models" class="anchor"></a>Survival models</h1>
<p><code><a href="../reference/ggpredict.html">ggpredict()</a></code> also supports <code>coxph</code>-models from the <strong>survival</strong>-package and is able to either plot risk-scores (the default), probabilities of survival (<code>type = "surv"</code>) or cumulative hazards (<code>type = "cumhaz"</code>).</p>
<p>Since probabilities of survival and cumulative hazards are changing accross time, the time-variable is automatically used as x-axis in such cases, so the <code>terms</code>-argument only needs up to <strong>two</strong> variables for <code>type = "surv"</code> or <code>type = "cumhaz"</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"lung"</span>, <span class="dt">package =</span> <span class="st">"survival"</span>)
<span class="co"># remove category 3 (outlier)</span>
lung &lt;-<span class="st"> </span><span class="kw">subset</span>(lung, <span class="dt">subset =</span> ph.ecog <span class="op">%in%</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span>)
lung<span class="op">$</span>sex &lt;-<span class="st"> </span><span class="kw">factor</span>(lung<span class="op">$</span>sex, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))
lung<span class="op">$</span>ph.ecog &lt;-<span class="st"> </span><span class="kw">factor</span>(lung<span class="op">$</span>ph.ecog, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"good"</span>, <span class="st">"ok"</span>, <span class="st">"limited"</span>))

m &lt;-<span class="st"> </span>survival<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/coxph">coxph</a></span>(survival<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(time, status) <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>ph.ecog, <span class="dt">data =</span> lung)

<span class="co"># predicted risk-scores</span>
<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(m, <span class="kw">c</span>(<span class="st">"sex"</span>, <span class="st">"ph.ecog"</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt; # Predicted risk scores </span>
<span class="co">#&gt; # x = sex </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # good</span>
<span class="co">#&gt;  x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;  1     0.829     0.148    0.621     1.107</span>
<span class="co">#&gt;  2     0.481     0.176    0.340     0.679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # ok</span>
<span class="co">#&gt;  x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;  1     1.249     0.107    1.013     1.540</span>
<span class="co">#&gt;  2     0.724     0.125    0.566     0.925</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # limited</span>
<span class="co">#&gt;  x predicted std.error conf.low conf.high</span>
<span class="co">#&gt;  1     2.044     0.157    1.503     2.781</span>
<span class="co">#&gt;  2     1.185     0.172    0.846     1.658</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; * age = 62.42</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># probability of survival</span>
<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(m, <span class="kw">c</span>(<span class="st">"sex"</span>, <span class="st">"ph.ecog"</span>), <span class="dt">type =</span> <span class="st">"surv"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; # Probability of Survival </span>
<span class="co">#&gt; # x = time </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # male</span>
<span class="co">#&gt; # good</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.997    0.989     1.000</span>
<span class="co">#&gt;   181     0.771    0.685     0.868</span>
<span class="co">#&gt;   276     0.645    0.536     0.776</span>
<span class="co">#&gt;  1022     0.086    0.028     0.264</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # male</span>
<span class="co">#&gt; # ok</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.995    0.984     1.000</span>
<span class="co">#&gt;   181     0.676    0.588     0.776</span>
<span class="co">#&gt;   276     0.517    0.417     0.640</span>
<span class="co">#&gt;  1022     0.025    0.006     0.108</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # male</span>
<span class="co">#&gt; # limited</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.992    0.974     1.000</span>
<span class="co">#&gt;   181     0.527    0.402     0.690</span>
<span class="co">#&gt;   276     0.339    0.220     0.523</span>
<span class="co">#&gt;  1022     0.002    0.000     0.041</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # female</span>
<span class="co">#&gt; # good</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.998    0.994     1.000</span>
<span class="co">#&gt;   181     0.860    0.794     0.932</span>
<span class="co">#&gt;   276     0.776    0.683     0.881</span>
<span class="co">#&gt;  1022     0.241    0.113     0.513</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # female</span>
<span class="co">#&gt; # ok</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.997    0.991     1.000</span>
<span class="co">#&gt;   181     0.797    0.724     0.877</span>
<span class="co">#&gt;   276     0.682    0.588     0.792</span>
<span class="co">#&gt;  1022     0.117    0.044     0.310</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # female</span>
<span class="co">#&gt; # limited</span>
<span class="co">#&gt;     x predicted conf.low conf.high</span>
<span class="co">#&gt;     5     0.995    0.985     1.000</span>
<span class="co">#&gt;   181     0.690    0.577     0.825</span>
<span class="co">#&gt;   276     0.535    0.401     0.713</span>
<span class="co">#&gt;  1022     0.030    0.005     0.187</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adjusted for:</span>
<span class="co">#&gt; * age = 62.42</span></code></pre></div>
</div>
<div id="labelling-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#labelling-the-data" class="anchor"></a>Labelling the data</h1>
<p><strong>ggeffects</strong> makes use of the <a href="https://cran.r-project.org/package=sjlabelled">sjlabelled-package</a> and supports <a href="https://cran.r-project.org/package=sjlabelled/vignettes/intro_sjlabelled.html">labelled data</a>. If the data from the fitted models is labelled, the value and variable label attributes are usually copied to the model frame stored in the model object. <strong>ggeffects</strong> provides various <em>getter</em>-functions to access these labels, which are returned as character vector and can be used in ggplot’s <code>lab()</code>- or <code>scale_*()</code>-functions.</p>
<ul>
<li>
<code><a href="../reference/get_title.html">get_title()</a></code> - a generic title for the plot, based on the model family, like “predicted values” or “predicted probabilities”</li>
<li>
<code><a href="../reference/get_title.html">get_x_title()</a></code> - the variable label of the first model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_y_title()</a></code> - the variable label of the response.</li>
<li>
<code><a href="../reference/get_title.html">get_legend_title()</a></code> - the variable label of the second model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_x_labels()</a></code> - value labels of the first model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_legend_labels()</a></code> - value labels of the second model term in <code>terms</code>.</li>
</ul>
<p>The data frame returned by <code><a href="../reference/ggpredict.html">ggpredict()</a></code> or <code><a href="../reference/ggpredict.html">ggaverage()</a></code> must be used as argument to one of the above function calls.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_title.html">get_x_title</a></span>(mydf)
<span class="co">#&gt; [1] "average number of hours of care per week"</span>
<span class="kw"><a href="../reference/get_title.html">get_y_title</a></span>(mydf)
<span class="co">#&gt; [1] "Negative impact with 7 items"</span>

<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="kw"><a href="../reference/get_title.html">get_x_title</a></span>(mydf),
    <span class="dt">y =</span> <span class="kw"><a href="../reference/get_title.html">get_y_title</a></span>(mydf),
    <span class="dt">colour =</span> <span class="kw"><a href="../reference/get_title.html">get_legend_title</a></span>(mydf)
  )</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#aim-of-the-ggeffects-package">Aim of the ggeffects-package</a></li>
      <li><a href="#consistent-and-tidy-structure">Consistent and tidy structure</a></li>
      <li><a href="#marginal-effects-at-the-mean">Marginal effects at the mean</a></li>
      <li><a href="#marginal-effects-at-the-mean-for-different-groups">Marginal effects at the mean for different groups</a></li>
      <li><a href="#marginal-effects-for-each-model-term">Marginal effects for each model term</a></li>
      <li><a href="#average-marginal-effects">Average marginal effects</a></li>
      <li><a href="#two--and-three-way-interactions">Two- and Three-Way-Interactions</a></li>
      <li><a href="#polynomial-terms-and-splines">Polynomial terms and splines</a></li>
      <li><a href="#survival-models">Survival models</a></li>
      <li><a href="#labelling-the-data">Labelling the data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Lüdecke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
