<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Data Frames of Marginal Effects • ggeffects</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Tidy Data Frames of Marginal Effects">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggeffects</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/marginaleffects.html">Tidy Data Frames of Marginal Effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/strengejacke/ggeffects">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tidy Data Frames of Marginal Effects</h1>
                        <h4 class="author">Daniel Lüdecke</h4>
            
            <h4 class="date">2018-05-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/master/vignettes/marginaleffects.Rmd"><code>vignettes/marginaleffects.Rmd</code></a></small>
      <div class="hidden name"><code>marginaleffects.Rmd</code></div>

    </div>

    
    
<div id="aim-of-the-ggeffects-package" class="section level1">
<h1 class="hasAnchor">
<a href="#aim-of-the-ggeffects-package" class="anchor"></a>Aim of the ggeffects-package</h1>
<p>The aim of this package is similar to the <a href="https://cran.r-project.org/package=broom">broom-package</a>: transforming “untidy” input into a tidy data frame, especially for further use with <a href="https://cran.r-project.org/package=ggplot2">ggplot</a>. However, <strong>ggeffects</strong> does not return model-summaries; rather, this package computes marginal effects at the mean or average marginal effects from statistical models and returns the result as tidy data frame (as <em>tibbles</em>, to be more precisely).</p>
<p>Since the focus lies on plotting the data (the marginal effects), at least one model term needs to be specified for which the effects are computed. It is also possible to compute marginal effects for model terms, grouped by the levels of another model’s predictor. The package also allows plotting marginal effects for two- or three-way-interactions, or for specific values of a model term only. Examples are shown below.</p>
</div>
<div id="consistent-and-tidy-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#consistent-and-tidy-structure" class="anchor"></a>Consistent and tidy structure</h1>
<p>The returned data frames always have the same, consistent structure and column names, so it’s easy to create ggplot-plots without the need to re-write the arguments to be mapped in each ggplot-call. <code>x</code> and <code>predicted</code> are the values for the x- and y-axis. <code>conf.low</code> and <code>conf.high</code> could be used as <code>ymin</code> and <code>ymax</code> aesthetics for ribbons to add confidence bands to the plot. <code>group</code> can be used as grouping-aesthetics, or for faceting.</p>
</div>
<div id="marginal-effects-at-the-mean" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-at-the-mean" class="anchor"></a>Marginal effects at the mean</h1>
<p><code><a href="../reference/ggpredict.html">ggpredict()</a></code> computes predicted values for all possible levels and values from a model’s predictors. In the simplest case, a fitted model is passed as first argument, and the term in question as second argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggeffects)
<span class="kw">data</span>(efc)
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(barthtot <span class="op">~</span><span class="st"> </span>c12hour <span class="op">+</span><span class="st"> </span>neg_c_<span class="dv">7</span> <span class="op">+</span><span class="st"> </span>c161sex <span class="op">+</span><span class="st"> </span>c172code, <span class="dt">data =</span> efc)

<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="st">"c12hour"</span>)
<span class="co">#&gt; # A tibble: 18 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt;  1     0      75.4     73.3      77.6 1    </span>
<span class="co">#&gt;  2    10      72.9     70.9      74.9 1    </span>
<span class="co">#&gt;  3    20      70.4     68.6      72.2 1    </span>
<span class="co">#&gt;  4    30      67.8     66.1      69.5 1    </span>
<span class="co">#&gt;  5    40      65.3     63.7      67.0 1    </span>
<span class="co">#&gt;  6    50      62.8     61.1      64.4 1    </span>
<span class="co">#&gt;  7    60      60.2     58.5      62.0 1    </span>
<span class="co">#&gt;  8    70      57.7     55.8      59.6 1    </span>
<span class="co">#&gt;  9    80      55.2     53.1      57.3 1    </span>
<span class="co">#&gt; 10    90      52.6     50.3      55.0 1    </span>
<span class="co">#&gt; 11   100      50.1     47.5      52.7 1    </span>
<span class="co">#&gt; 12   110      47.6     44.7      50.4 1    </span>
<span class="co">#&gt; 13   120      45.0     41.9      48.2 1    </span>
<span class="co">#&gt; 14   130      42.5     39.1      45.9 1    </span>
<span class="co">#&gt; 15   140      40.0     36.3      43.7 1    </span>
<span class="co">#&gt; 16   150      37.4     33.4      41.5 1    </span>
<span class="co">#&gt; 17   160      34.9     30.6      39.2 1    </span>
<span class="co">#&gt; 18   170      32.4     27.7      37.0 1</span></code></pre></div>
<p>The output shows the predicted values for the response at each value from the term <em>c12hour</em>. The data is already in shape for ggplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())

mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="st">"c12hour"</span>)
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="marginal-effects-at-the-mean-for-different-groups" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-at-the-mean-for-different-groups" class="anchor"></a>Marginal effects at the mean for different groups</h1>
<p>The <code>terms</code>-argument accepts up to three model terms, where the second and third term indicate grouping levels. This allows predictions for the term in question at different levels for other model terms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="co">#&gt; # A tibble: 54 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group                          </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;                          </span>
<span class="co">#&gt;  1     0      74.7     71.3      78.2 low level of education         </span>
<span class="co">#&gt;  2     0      75.5     73.3      77.6 intermediate level of education</span>
<span class="co">#&gt;  3     0      76.2     72.8      79.5 high level of education        </span>
<span class="co">#&gt;  4    10      72.2     68.9      75.5 low level of education         </span>
<span class="co">#&gt;  5    10      72.9     71.0      74.9 intermediate level of education</span>
<span class="co">#&gt;  6    10      73.7     70.4      76.9 high level of education        </span>
<span class="co">#&gt;  7    20      69.7     66.5      72.9 low level of education         </span>
<span class="co">#&gt;  8    20      70.4     68.6      72.2 intermediate level of education</span>
<span class="co">#&gt;  9    20      71.1     67.9      74.3 high level of education        </span>
<span class="co">#&gt; 10    30      67.1     64.0      70.3 low level of education         </span>
<span class="co">#&gt; # ... with 44 more rows</span></code></pre></div>
<p>Creating a ggplot is pretty straightforward: the colour-aesthetics is mapped with the <code>group</code>-column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Finally, a second grouping structure can be defined, which will create another column named <code>facet</code>, which - as the name implies - might be used to create a facted plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>, <span class="st">"c161sex"</span>))
mydf
<span class="co">#&gt; # A tibble: 108 x 6</span>
<span class="co">#&gt;        x predicted conf.low conf.high group                           facet     </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;                           &lt;fct&gt;     </span>
<span class="co">#&gt;  1     0      74.0     69.4      78.6 low level of education          [1] Male  </span>
<span class="co">#&gt;  2     0      75.0     71.4      78.6 low level of education          [2] Female</span>
<span class="co">#&gt;  3     0      74.7     71.1      78.3 intermediate level of education [1] Male  </span>
<span class="co">#&gt;  4     0      75.7     73.3      78.1 intermediate level of education [2] Female</span>
<span class="co">#&gt;  5     0      75.4     71.0      79.7 high level of education         [1] Male  </span>
<span class="co">#&gt;  6     0      76.4     72.9      80.0 high level of education         [2] Female</span>
<span class="co">#&gt;  7    10      71.4     66.9      75.9 low level of education          [1] Male  </span>
<span class="co">#&gt;  8    10      72.5     69.0      75.9 low level of education          [2] Female</span>
<span class="co">#&gt;  9    10      72.1     68.6      75.7 intermediate level of education [1] Male  </span>
<span class="co">#&gt; 10    10      73.2     71.0      75.4 intermediate level of education [2] Female</span>
<span class="co">#&gt; # ... with 98 more rows</span>
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="marginal-effects-for-each-model-term" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-for-each-model-term" class="anchor"></a>Marginal effects for each model term</h1>
<p>If the <code>term</code> argument is either missing or <code>NULL</code>, marginal effects for each model term are calculated. The result is returned as a list, which can be plotted manually (or using the <code><a href="../reference/plot.html">plot()</a></code> function).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit)
mydf
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 18 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt;  1     0      75.4     73.3      77.6 1    </span>
<span class="co">#&gt;  2    10      72.9     70.9      74.9 1    </span>
<span class="co">#&gt;  3    20      70.4     68.6      72.2 1    </span>
<span class="co">#&gt;  4    30      67.8     66.1      69.5 1    </span>
<span class="co">#&gt;  5    40      65.3     63.7      67.0 1    </span>
<span class="co">#&gt;  6    50      62.8     61.1      64.4 1    </span>
<span class="co">#&gt;  7    60      60.2     58.5      62.0 1    </span>
<span class="co">#&gt;  8    70      57.7     55.8      59.6 1    </span>
<span class="co">#&gt;  9    80      55.2     53.1      57.3 1    </span>
<span class="co">#&gt; 10    90      52.6     50.3      55.0 1    </span>
<span class="co">#&gt; 11   100      50.1     47.5      52.7 1    </span>
<span class="co">#&gt; 12   110      47.6     44.7      50.4 1    </span>
<span class="co">#&gt; 13   120      45.0     41.9      48.2 1    </span>
<span class="co">#&gt; 14   130      42.5     39.1      45.9 1    </span>
<span class="co">#&gt; 15   140      40.0     36.3      43.7 1    </span>
<span class="co">#&gt; 16   150      37.4     33.4      41.5 1    </span>
<span class="co">#&gt; 17   160      34.9     30.6      39.2 1    </span>
<span class="co">#&gt; 18   170      32.4     27.7      37.0 1    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; # A tibble: 21 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt;  1     7      75.9     73.2      78.6 1    </span>
<span class="co">#&gt;  2     8      73.6     71.2      75.9 1    </span>
<span class="co">#&gt;  3     9      71.3     69.2      73.3 1    </span>
<span class="co">#&gt;  4    10      69.0     67.1      70.8 1    </span>
<span class="co">#&gt;  5    11      66.7     65.0      68.4 1    </span>
<span class="co">#&gt;  6    12      64.4     62.7      66.0 1    </span>
<span class="co">#&gt;  7    13      62.1     60.4      63.8 1    </span>
<span class="co">#&gt;  8    14      59.8     57.9      61.7 1    </span>
<span class="co">#&gt;  9    15      57.5     55.3      59.7 1    </span>
<span class="co">#&gt; 10    16      55.2     52.7      57.7 1    </span>
<span class="co">#&gt; # ... with 11 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; # A tibble: 2 x 5</span>
<span class="co">#&gt;       x predicted conf.low conf.high group</span>
<span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt; 1     1      64.0     60.6      67.3 1    </span>
<span class="co">#&gt; 2     2      65.0     63.1      66.9 1    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;       x predicted conf.low conf.high group</span>
<span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt; 1     1      64.1     61.0      67.1 1    </span>
<span class="co">#&gt; 2     2      64.8     63.1      66.4 1    </span>
<span class="co">#&gt; 3     3      65.5     62.3      68.7 1    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "ggeffectslist" "list"</span></code></pre></div>
</div>
<div id="average-marginal-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#average-marginal-effects" class="anchor"></a>Average marginal effects</h1>
<p><code><a href="../reference/ggpredict.html">ggaverage()</a></code> compute average marginal effects. While <code><a href="../reference/ggpredict.html">ggpredict()</a></code> creates a data-grid (using <code>expand.grid()</code>) for all possible combinations of values (even if some combinations are not present in the data), <code><a href="../reference/ggpredict.html">ggaverage()</a></code> computes predicted values based on the given data. This means that <em>different</em> predicted values for the outcome may occure at the <em>same</em> value or level for the term in question. The predicted values are then averaged for each value of the term in question and the linear trend is smoothed accross the averaged predicted values. This means that the line representing the marginal effects may cross or diverge, and are not necessarily in paralell to each other.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggaverage</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="marginal-effects-at-specific-values-or-levels" class="section level1">
<h1 class="hasAnchor">
<a href="#marginal-effects-at-specific-values-or-levels" class="anchor"></a>Marginal effects at specific values or levels</h1>
<p>The <code>terms</code>-argument not only defines the model terms of interest, but each model term <em>that defines the grouping structure</em> can be limited to certain values. This allows to compute and plot marginal effects for terms at specific values only. To define these values, put them in square brackets directly after the term name. Ranges are specified with colon: <code>terms = c("c12hour [30:80]", "c172code [1,3]")</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour [30:80]"</span>, <span class="st">"c172code [1,3]"</span>))
mydf
<span class="co">#&gt; # A tibble: 12 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group                  </span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;                  </span>
<span class="co">#&gt;  1    30      67.1     64.0      70.3 low level of education </span>
<span class="co">#&gt;  2    30      68.6     65.4      71.8 high level of education</span>
<span class="co">#&gt;  3    40      64.6     61.6      67.7 low level of education </span>
<span class="co">#&gt;  4    40      66.1     62.9      69.2 high level of education</span>
<span class="co">#&gt;  5    50      62.1     59.0      65.1 low level of education </span>
<span class="co">#&gt;  6    50      63.5     60.3      66.7 high level of education</span>
<span class="co">#&gt;  7    60      59.5     56.5      62.6 low level of education </span>
<span class="co">#&gt;  8    60      61.0     57.7      64.3 high level of education</span>
<span class="co">#&gt;  9    70      57.0     53.9      60.1 low level of education </span>
<span class="co">#&gt; 10    70      58.5     55.1      61.8 high level of education</span>
<span class="co">#&gt; 11    80      54.5     51.3      57.7 low level of education </span>
<span class="co">#&gt; 12    80      55.9     52.4      59.5 high level of education</span>
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>This is especially useful when variables are, for instance, log-transformed. <code><a href="../reference/ggpredict.html">ggpredict()</a></code> then typically only uses the range of the log-transformed variable, which is in most cases not what we want. In such situation, specify the range in the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
mpg_model &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(hp), <span class="dt">data =</span> mtcars)

<span class="co"># x-values and predictions based on the log(hp)-values</span>
<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(mpg_model, <span class="st">"hp"</span>)
<span class="co">#&gt; # A tibble: 22 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt;  1  3.95      57.9     49.4      66.3 1    </span>
<span class="co">#&gt;  2  4.13      57.4     49.0      65.8 1    </span>
<span class="co">#&gt;  3  4.17      57.3     48.9      65.6 1    </span>
<span class="co">#&gt;  4  4.19      57.2     48.9      65.6 1    </span>
<span class="co">#&gt;  5  4.51      56.4     48.2      64.6 1    </span>
<span class="co">#&gt;  6  4.53      56.4     48.2      64.5 1    </span>
<span class="co">#&gt;  7  4.55      56.3     48.2      64.5 1    </span>
<span class="co">#&gt;  8  4.57      56.3     48.1      64.4 1    </span>
<span class="co">#&gt;  9  4.65      56.1     48.0      64.2 1    </span>
<span class="co">#&gt; 10  4.69      56.0     47.9      64.1 1    </span>
<span class="co">#&gt; # ... with 12 more rows</span>

<span class="co"># x-values and predictions based hp-values from 50 to 150</span>
<span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(mpg_model, <span class="st">"hp [50:150]"</span>)
<span class="co">#&gt; # A tibble: 11 x 5</span>
<span class="co">#&gt;        x predicted conf.low conf.high group</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;</span>
<span class="co">#&gt;  1    50      30.5     27.9      33.1 1    </span>
<span class="co">#&gt;  2    60      28.6     26.4      30.8 1    </span>
<span class="co">#&gt;  3    70      26.9     25.0      28.8 1    </span>
<span class="co">#&gt;  4    80      25.5     23.8      27.1 1    </span>
<span class="co">#&gt;  5    90      24.2     22.8      25.7 1    </span>
<span class="co">#&gt;  6   100      23.1     21.8      24.4 1    </span>
<span class="co">#&gt;  7   110      22.0     20.8      23.2 1    </span>
<span class="co">#&gt;  8   120      21.1     20.0      22.3 1    </span>
<span class="co">#&gt;  9   130      20.2     19.1      21.4 1    </span>
<span class="co">#&gt; 10   140      19.4     18.3      20.6 1    </span>
<span class="co">#&gt; 11   150      18.7     17.5      19.9 1</span></code></pre></div>
</div>
<div id="two--and-three-way-interactions" class="section level1">
<h1 class="hasAnchor">
<a href="#two--and-three-way-interactions" class="anchor"></a>Two- and Three-Way-Interactions</h1>
<p>To plot the marginal effects of interaction terms, simply specify these terms in the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sjmisc)
<span class="kw">data</span>(efc)

<span class="co"># make categorical</span>
efc<span class="op">$</span>c161sex &lt;-<span class="st"> </span><span class="kw">to_factor</span>(efc<span class="op">$</span>c161sex)

<span class="co"># fit model with interaction</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(neg_c_<span class="dv">7</span> <span class="op">~</span><span class="st"> </span>c12hour <span class="op">+</span><span class="st"> </span>barthtot <span class="op">*</span><span class="st"> </span>c161sex, <span class="dt">data =</span> efc)

<span class="co"># select only levels 30, 50 and 70 from continuous variable Barthel-Index</span>
mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"barthtot [30,50,70]"</span>, <span class="st">"c161sex"</span>))
<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Since the <code>terms</code>-argument accepts up to three model terms, you can also compute marginal effects for a 3-way-interaction.</p>
<p>To plot the marginal effects of interaction terms, simply specify these terms in the <code>terms</code>-argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit model with 3-way-interaction</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(neg_c_<span class="dv">7</span> <span class="op">~</span><span class="st"> </span>c12hour <span class="op">*</span><span class="st"> </span>barthtot <span class="op">*</span><span class="st"> </span>c161sex, <span class="dt">data =</span> efc)

<span class="co"># select only levels 30, 50 and 70 from continuous variable Barthel-Index</span>
mydf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"barthtot [30,50,70]"</span>, <span class="st">"c161sex"</span>))

<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div id="polynomial-terms-and-splines" class="section level1">
<h1 class="hasAnchor">
<a href="#polynomial-terms-and-splines" class="anchor"></a>Polynomial terms and splines</h1>
<p><code><a href="../reference/ggpredict.html">ggpredict()</a></code> also works for models with polynomial terms or splines. Following code reproduces the plot from <code><a href="http://www.rdocumentation.org/packages/splines/topics/bs">?splines::bs</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(splines)
<span class="kw">data</span>(women)

fm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(height, <span class="dt">df =</span> <span class="dv">5</span>), <span class="dt">data =</span> women)
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fm1, <span class="st">"height"</span>)

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div id="labelling-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#labelling-the-data" class="anchor"></a>Labelling the data</h1>
<p><strong>ggeffects</strong> makes use of the <a href="https://cran.r-project.org/package=sjlabelled">sjlabelled-package</a> and supports <a href="https://cran.r-project.org/package=sjlabelled/vignettes/intro_sjlabelled.html">labelled data</a>. If the data from the fitted models is labelled, the value and variable label attributes are usually copied to the model frame stored in the model object. <strong>ggeffects</strong> provides various <em>getter</em>-functions to access these labels, which are returned as character vector and can be used in ggplot’s <code>lab()</code>- or <code>scale_*()</code>-functions.</p>
<ul>
<li>
<code><a href="../reference/get_title.html">get_title()</a></code> - a generic title for the plot, based on the model family, like “predicted values” or “predicted probabilities”</li>
<li>
<code><a href="../reference/get_title.html">get_x_title()</a></code> - the variable label of the first model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_y_title()</a></code> - the variable label of the response.</li>
<li>
<code><a href="../reference/get_title.html">get_legend_title()</a></code> - the variable label of the second model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_x_labels()</a></code> - value labels of the first model term in <code>terms</code>.</li>
<li>
<code><a href="../reference/get_title.html">get_legend_labels()</a></code> - value labels of the second model term in <code>terms</code>.</li>
</ul>
<p>The data frame returned by <code><a href="../reference/ggpredict.html">ggpredict()</a></code> or <code><a href="../reference/ggpredict.html">ggaverage()</a></code> must be used as argument to one of the above function calls.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_title.html">get_x_title</a></span>(mydf)
<span class="co">#&gt; [1] "average number of hours of care per week"</span>
<span class="kw"><a href="../reference/get_title.html">get_y_title</a></span>(mydf)
<span class="co">#&gt; [1] "Negative impact with 7 items"</span>

<span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(x, predicted, <span class="dt">colour =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="kw"><a href="../reference/get_title.html">get_x_title</a></span>(mydf),
    <span class="dt">y =</span> <span class="kw"><a href="../reference/get_title.html">get_y_title</a></span>(mydf),
    <span class="dt">colour =</span> <span class="kw"><a href="../reference/get_title.html">get_legend_title</a></span>(mydf)
  )</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div id="plot-method" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-method" class="anchor"></a>plot()-method</h1>
<p>If you don’t want to write your own ggplot-code, <strong>ggeffects</strong> has a <code><a href="../reference/plot.html">plot()</a></code>-method with some convenient defaults, which allows quickly creating ggplot-objects. <code><a href="../reference/plot.html">plot()</a></code> has only a few arguments to keep this function small and simple. For instance, <code>ci</code> allows you to show or hide confidence bands (or error bars, for discrete variables), <code>facets</code> allows you to create facets even for just one grouping variable, or <code>colors</code> allows you to quickly choose from some color-palettes, including black &amp; white colored plots. Use <code>rawdata</code> to add the raw data points to the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(efc)
efc<span class="op">$</span>c172code &lt;-<span class="st"> </span><span class="kw">to_label</span>(efc<span class="op">$</span>c172code)
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(barthtot <span class="op">~</span><span class="st"> </span>c12hour <span class="op">+</span><span class="st"> </span>neg_c_<span class="dv">7</span> <span class="op">+</span><span class="st"> </span>c161sex <span class="op">+</span><span class="st"> </span>c172code, <span class="dt">data =</span> efc)

<span class="co"># facet by group</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw"><a href="../reference/plot.html">plot</a></span>(dat, <span class="dt">facet =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># don't use facets, b/w figure, w/o confidence bands</span>
<span class="kw"><a href="../reference/plot.html">plot</a></span>(dat, <span class="dt">colors =</span> <span class="st">"bw"</span>, <span class="dt">ci =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot raw data</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>))
<span class="kw"><a href="../reference/plot.html">plot</a></span>(dat, <span class="dt">rawdata =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-14-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for three variables, automatic facetting</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c12hour"</span>, <span class="st">"c172code"</span>, <span class="st">"c161sex"</span>))
<span class="kw"><a href="../reference/plot.html">plot</a></span>(dat)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-14-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># categorical variables have errorbars</span>
dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggpredict.html">ggpredict</a></span>(fit, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"c172code"</span>, <span class="st">"c161sex"</span>))
<span class="kw"><a href="../reference/plot.html">plot</a></span>(dat)</code></pre></div>
<p><img src="marginaleffects_files/figure-html/unnamed-chunk-14-5.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#aim-of-the-ggeffects-package">Aim of the ggeffects-package</a></li>
      <li><a href="#consistent-and-tidy-structure">Consistent and tidy structure</a></li>
      <li><a href="#marginal-effects-at-the-mean">Marginal effects at the mean</a></li>
      <li><a href="#marginal-effects-at-the-mean-for-different-groups">Marginal effects at the mean for different groups</a></li>
      <li><a href="#marginal-effects-for-each-model-term">Marginal effects for each model term</a></li>
      <li><a href="#average-marginal-effects">Average marginal effects</a></li>
      <li><a href="#marginal-effects-at-specific-values-or-levels">Marginal effects at specific values or levels</a></li>
      <li><a href="#two--and-three-way-interactions">Two- and Three-Way-Interactions</a></li>
      <li><a href="#polynomial-terms-and-splines">Polynomial terms and splines</a></li>
      <li><a href="#labelling-the-data">Labelling the data</a></li>
      <li><a href="#plot-method">plot()-method</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Lüdecke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
